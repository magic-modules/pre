<!DOCTYPE html><html><head><meta charset="utf-8"/><link rel="icon" href="/pre/favicon.ico"/><link rel="stylesheet" href="/pre/magic.css"/></head><body><div id="magic"><div class="wrapper"><header class="main"></header><div class="page"><div><h1>@magic-modules/pre</h1><p>this is the <a href="https://github.com/magic-modules" rel="noopener" target="_blank">@magic-modules</a> Pre component</p><h2>require:</h2><p>first add the component to the assets</p><div class="Pre"><div class="line"></div><div class="line"><div class="line comment">// assets/index.js</div></div><div class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</div><div class="line"><div class="line comment">  //...other exports</div></div><div class="line">  <span class="colon">Pre</span>: require(<span class="string">&#39;@magic-modules/pre&#39;</span>),</div><div class="line">}</div></div><h2>usage:</h2><p>in a page/component, just pass some string that looks like js</p><div class="Pre"><div class="line"><span class="keyword">module</span>.<span class="keyword">exports</span> = {</div><div class="line">  <span class="colon">View</span>: () =&gt; Pre.View(<span class="string">&#39;const js = true&#39;</span>),</div><div class="line">}</div></div><h2>source</h2><p>the source for this page is in the <a href="https://github.com/magic-modules/pre/tree/master/example" rel="noopener" target="_blank">example directory</a> and gets built and published to github using <a href="https://github.com/magic/core" rel="noopener" target="_blank">@magic/core</a></p><h2>recursion</h2><p>this is what the Pre component looks when rendered by Pre.View(Pre.View.toString())</p><div class="Pre"><div class="line">content =&gt; {</div><div class="line">    <span class="keyword">const</span><span class="keyword"> </span>format = content =&gt; {</div><div class="line">      <span class="keyword">const</span><span class="keyword"> </span>keywords = `</div><div class="line"><span class="keyword">let</span><span class="keyword"> </span><span class="keyword">this</span><span class="keyword"> </span><span class="keyword">long</span><span class="keyword"> </span><span class="keyword">package</span><span class="keyword"> </span><span class="keyword">float</span></div><div class="line"><span class="keyword">goto</span><span class="keyword"> </span><span class="keyword">private</span><span class="keyword"> </span><span class="keyword">class</span><span class="keyword"> </span><span class="keyword">if</span><span class="keyword"> </span><span class="keyword">short</span></div><div class="line"><span class="keyword">while</span><span class="keyword"> </span><span class="keyword">protected</span><span class="keyword"> </span><span class="keyword">with</span><span class="keyword"> </span><span class="keyword">debugger</span><span class="keyword"> </span><span class="keyword">case</span></div><div class="line"><span class="keyword">continue</span><span class="keyword"> </span><span class="keyword">volatile</span><span class="keyword"> </span><span class="keyword">interface</span></div><div class="line"></div><div class="line"><span class="keyword">instanceof</span><span class="keyword"> </span><span class="keyword">super</span><span class="keyword"> </span><span class="keyword">synchronized</span><span class="keyword"> </span><span class="keyword">throw</span></div><div class="line"><span class="keyword">extends</span><span class="keyword"> </span><span class="keyword">final</span><span class="keyword"> </span><span class="keyword">export</span><span class="keyword"> </span><span class="keyword">throws</span></div><div class="line"><span class="keyword">try</span><span class="keyword"> </span><span class="keyword">import</span><span class="keyword"> </span><span class="keyword">double</span><span class="keyword"> </span><span class="keyword">enum</span></div><div class="line"></div><div class="line"><span class="keyword">boolean</span><span class="keyword"> </span><span class="keyword">abstract</span><span class="keyword"> </span><span class="keyword">function</span></div><div class="line"><span class="keyword">implements</span><span class="keyword"> </span><span class="keyword">typeof</span><span class="keyword"> </span><span class="keyword">transient</span><span class="keyword"> </span><span class="keyword">break</span></div><div class="line"><span class="keyword">void</span><span class="keyword"> </span><span class="keyword">static</span><span class="keyword"> </span><span class="keyword">default</span><span class="keyword"> </span><span class="keyword">do</span></div><div class="line"></div><div class="line"><span class="keyword">boolean</span><span class="keyword"> </span><span class="keyword">abstract</span><span class="keyword"> </span><span class="keyword">implements</span></div><div class="line"><span class="keyword">typeof</span><span class="keyword"> </span><span class="keyword">function</span><span class="keyword"> </span><span class="keyword">do</span><span class="keyword"> </span><span class="keyword">break</span></div><div class="line"><span class="keyword">void</span><span class="keyword"> </span><span class="keyword">static</span><span class="keyword"> </span><span class="keyword">default</span><span class="keyword"> </span><span class="keyword">transient</span></div><div class="line"></div><div class="line"><span class="keyword">int</span><span class="keyword"> </span><span class="keyword">new</span><span class="keyword"> </span><span class="keyword">async</span><span class="keyword"> </span><span class="keyword">native</span><span class="keyword"> </span><span class="keyword">switch</span></div><div class="line"><span class="keyword">else</span><span class="keyword"> </span><span class="keyword">delete</span><span class="keyword"> </span><span class="keyword">null</span><span class="keyword"> </span><span class="keyword">public</span><span class="keyword"> </span><span class="keyword">var</span></div><div class="line"><span class="keyword">await</span><span class="keyword"> </span><span class="keyword">byte</span><span class="keyword"> </span><span class="keyword">finally</span><span class="keyword"> </span><span class="keyword">catch</span></div><div class="line"><span class="keyword">in</span><span class="keyword"> </span><span class="keyword">return</span><span class="keyword"> </span><span class="keyword">for</span><span class="keyword"> </span><span class="keyword">get</span><span class="keyword"> </span><span class="keyword">const</span><span class="keyword"> </span><span class="keyword">char</span></div><div class="line"><span class="keyword">module</span><span class="keyword"> </span><span class="keyword">exports</span></div><div class="line">`</div><div class="line">        .replace(<span class="string">&#39; &#39;</span>, <span class="string">&#39;&#39;</span>)</div><div class="line">        .replace(<span class="string">&#39;\n&#39;</span>, <span class="string">&#39;&#39;</span>)</div><div class="line"></div><div class="line">      <span class="keyword">const</span><span class="keyword"> </span>builtins = `</div><div class="line"><span class="builtin">Array</span><span class="keyword"> </span><span class="builtin">Object</span><span class="keyword"> </span><span class="builtin">String</span><span class="keyword"> </span><span class="builtin">Number</span><span class="keyword"> </span><span class="builtin">RegExp</span><span class="keyword"> </span><span class="builtin">Null</span><span class="keyword"> </span><span class="builtin">Symbol</span></div><div class="line"><span class="builtin">Set</span><span class="keyword"> </span><span class="builtin">WeakSet</span><span class="keyword"> </span><span class="builtin">Map</span><span class="keyword"> </span><span class="builtin">WeakMap</span></div><div class="line"><span class="builtin">setInterval</span><span class="keyword"> </span><span class="builtin">setTimeout</span></div><div class="line"><span class="builtin">Promise</span></div><div class="line"><span class="builtin">JSON</span></div><div class="line"><span class="builtin">Int8Array</span><span class="keyword"> </span><span class="builtin">Uint8Array</span><span class="keyword"> </span><span class="builtin">Uint8ClampedArray</span></div><div class="line"><span class="builtin">Int16Array</span><span class="keyword"> </span><span class="builtin">Uint16Array</span></div><div class="line"><span class="builtin">Int32Array</span><span class="keyword"> </span><span class="builtin">Uint32Array</span></div><div class="line"><span class="builtin">Float32Array</span><span class="keyword"> </span><span class="builtin">Float64Array</span></div><div class="line">`</div><div class="line">        .replace(<span class="string">&#39; &#39;</span>, <span class="string">&#39;&#39;</span>)</div><div class="line">        .replace(<span class="string">&#39;\n&#39;</span>, <span class="string">&#39;&#39;</span>)</div><div class="line"></div><div class="line">      <span class="keyword">const</span><span class="keyword"> </span>booleans = `<span class="boolean">true</span><span class="keyword"> </span><span class="boolean">false</span>`</div><div class="line"></div><div class="line">      <span class="keyword">const</span><span class="keyword"> </span>hyperWords = `<span class="state">state</span><span class="keyword"> </span><span class="actions">actions</span>`</div><div class="line"></div><div class="line">      <span class="keyword">const</span><span class="keyword"> </span>wrapWords = string =&gt; {</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span><span class="keyword"> </span>string !== <span class="string">&#39;string&#39;</span>) {</div><div class="line">          <span class="keyword">return</span><span class="keyword"> </span>string</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">const</span><span class="keyword"> </span>matched = string.split(/\<span class="keyword">b</span>/)</div><div class="line"></div><div class="line">        string = matched.map((word, <span class="keyword">i</span>) =&gt; {</div><div class="line">          <span class="keyword">if</span> (word === <span class="string">&#39;&#39;</span>) {</div><div class="line">            <span class="keyword">return</span></div><div class="line">          }</div><div class="line"></div><div class="line">          <span class="keyword">let</span><span class="keyword"> </span><span class="keyword">cl</span> = <span class="string">&#39;&#39;</span></div><div class="line">          <span class="keyword">if</span> (matched[<span class="keyword">i</span> + <span class="builtin">1</span>] &amp;&amp; matched[<span class="keyword">i</span> + <span class="builtin">1</span>].includes(<span class="string">&#39;:&#39;</span>)) {</div><div class="line">            <span class="keyword">cl</span> = <span class="string">&#39;colon&#39;</span></div><div class="line">          } <span class="keyword">else</span><span class="keyword"> </span><span class="keyword">if</span> (isTag(word)) {</div><div class="line">            <span class="keyword">cl</span> = <span class="string">&#39;tag&#39;</span></div><div class="line">          } <span class="keyword">else</span><span class="keyword"> </span><span class="keyword">if</span> (keywords.includes(word)) {</div><div class="line">            <span class="keyword">cl</span> = <span class="string">&#39;keyword&#39;</span></div><div class="line">          } <span class="keyword">else</span><span class="keyword"> </span><span class="keyword">if</span> (builtins.includes(word)) {</div><div class="line">            <span class="keyword">cl</span> = <span class="string">&#39;builtin&#39;</span></div><div class="line">          } <span class="keyword">else</span><span class="keyword"> </span><span class="keyword">if</span> (word === <span class="string">&#39;state&#39;</span>) {</div><div class="line">            <span class="keyword">cl</span> = <span class="string">&#39;state&#39;</span></div><div class="line">          } <span class="keyword">else</span><span class="keyword"> </span><span class="keyword">if</span> (word === <span class="string">&#39;actions&#39;</span>) {</div><div class="line">            <span class="keyword">cl</span> = <span class="string">&#39;actions&#39;</span></div><div class="line">          } <span class="keyword">else</span><span class="keyword"> </span><span class="keyword">if</span> (booleans.includes(word)) {</div><div class="line">            <span class="keyword">cl</span> = <span class="string">&#39;boolean&#39;</span></div><div class="line">          }</div><div class="line"></div><div class="line">          <span class="keyword">if</span> (<span class="keyword">cl</span>) {</div><div class="line">            word = span({ <span class="colon">class</span>: <span class="keyword">cl</span> }, word)</div><div class="line">          }</div><div class="line"></div><div class="line">          <span class="keyword">return</span><span class="keyword"> </span>word</div><div class="line">        })</div><div class="line"></div><div class="line">        <span class="keyword">return</span><span class="keyword"> </span>string</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="keyword">const</span><span class="keyword"> </span>known = <span class="string">&#39;[object HTMLDivElement]&#39;</span></div><div class="line">      <span class="keyword">const</span><span class="keyword"> </span>tags = {</div><div class="line">        <span class="colon">canvas</span>: <span class="builtin">1</span>,</div><div class="line">        <span class="colon">video</span>: <span class="builtin">1</span>,</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="keyword">const</span><span class="keyword"> </span>wordsByLine = line =&gt; {</div><div class="line">        <span class="keyword">if</span> (line.trim().startsWith(<span class="string">&#39;//&#39;</span>)) {</div><div class="line">          <span class="keyword">return</span><span class="keyword"> </span>div({ <span class="colon">class</span>: <span class="string">&#39;line comment&#39;</span> }, line)</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">const</span><span class="keyword"> </span>cleaned = line.replace(/<span class="string">&#39;/g, &#39;</span><span class="string">&#39;&#39;</span>)</div><div class="line">        <span class="keyword">const</span> [start, <span class="keyword">str</span>, ...rest] = cleaned.split(<span class="string">&#39;&#39;</span><span class="string">&#39;)&#39;</span></div><div class="line">        <span class="keyword">let</span><span class="keyword"> </span><span class="keyword">end</span> = rest</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">end</span>.length === <span class="builtin">1</span>) {</div><div class="line">          <span class="keyword">end</span> = wordsByLine(<span class="keyword">end</span>[0])</div><div class="line">        } <span class="keyword">else</span><span class="keyword"> </span><span class="keyword">if</span> (<span class="keyword">end</span>.length &gt; <span class="builtin">1</span>) {</div><div class="line">          <span class="keyword">end</span> = wordsByLine(<span class="keyword">end</span>.join(<span class="string">&#39;&#39;</span><span class="string">&#39;))&#39;</span></div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">let</span><span class="keyword"> </span>words = []</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span><span class="keyword"> </span><span class="keyword">str</span> !== <span class="string">&#39;undefined&#39;</span>) {</div><div class="line">          words = [wrapWords(start), span({ <span class="colon">class</span>: <span class="string">&#39;string&#39;</span> }, `<span class="string">&#39;${str}&#39;</span>`), <span class="keyword">end</span>]</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">          words = wrapWords(line)</div><div class="line">        }</div><div class="line">        <span class="keyword">return</span><span class="keyword"> </span>words</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="keyword">const</span><span class="keyword"> </span>isTag = word =&gt; {</div><div class="line">        <span class="keyword">if</span> (tags.hasOwnProperty(word)) {</div><div class="line">          <span class="keyword">return</span><span class="keyword"> </span><span class="boolean">true</span></div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">          <span class="keyword">try</span> {</div><div class="line">            <span class="keyword">const</span><span class="keyword"> </span><span class="keyword">ele</span> =</div><div class="line">              <span class="keyword">typeof</span><span class="keyword"> </span>global !== <span class="string">&#39;undefined&#39;</span></div><div class="line">                ? <span class="builtin">Object</span>.keys(app.dependencies).includes(word)</div><div class="line">                : document.createElement(word).toString() === known</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">ele</span>) {</div><div class="line">              tags[word] = <span class="boolean">true</span></div><div class="line">              <span class="keyword">return</span><span class="keyword"> </span><span class="boolean">true</span></div><div class="line">            }</div><div class="line">          } <span class="keyword">catch</span> (<span class="keyword">e</span>) {}</div><div class="line">        }</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="keyword">const</span><span class="keyword"> </span>lines = content.split(<span class="string">&#39;\n&#39;</span>).map(line =&gt; div({ <span class="colon">class</span>: <span class="string">&#39;line&#39;</span> }, wordsByLine(line)))</div><div class="line"></div><div class="line">      <span class="keyword">return</span><span class="keyword"> </span>lines</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">return</span><span class="keyword"> </span>div({ <span class="colon">class</span>: <span class="string">&#39;Pre&#39;</span> }, format(content))</div><div class="line">  }</div></div></div></div><footer class="main"><div class="wrapper">made with a few bits of <a href="" rel="noopener" target="_blank">magic</a></div></footer></div></div><script type="text/javascript" src="/pre/magic.js"></script></body></html>